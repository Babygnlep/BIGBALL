<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BIGBALL</title>

<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
/* ‚îÄ‚îÄ‚îÄ Reset & Root ‚îÄ‚îÄ‚îÄ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --primary:    #6366f1;
  --primary-lo: rgba(99,102,241,.18);
  --accent:     #06b6d4;
  --accent-lo:  rgba(6,182,212,.15);
  --success:    #34d399;
  --success-lo: rgba(52,211,153,.15);
  --warning:    #fbbf24;
  --warning-lo: rgba(251,191,36,.15);
  --danger:     #f87171;
  --danger-lo:  rgba(248,113,113,.15);

  --bg:         #0c1121;
  --surface:    #131d33;
  --surface-hi: #1a2744;
  --border:     rgba(148,163,184,.10);
  --border-hi:  rgba(148,163,184,.22);

  --text-1:     #f1f5f9;
  --text-2:     #94a3b8;
  --text-3:     #475569;

  --radius:     16px;
  --radius-sm:  10px;
  --radius-lg:  22px;
}

/* ‚îÄ‚îÄ‚îÄ Body & Background ‚îÄ‚îÄ‚îÄ */
body {
  font-family: 'Kanit', sans-serif;
  background: var(--bg);
  color: var(--text-1);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* Ambient glow blobs */
body::before, body::after {
  content: '';
  position: fixed;
  border-radius: 50%;
  filter: blur(100px);
  opacity: .18;
  pointer-events: none;
  z-index: 0;
}
body::before {
  width: 380px; height: 380px;
  background: var(--primary);
  top: -120px; left: -100px;
}
body::after {
  width: 320px; height: 320px;
  background: var(--accent);
  bottom: -80px; right: -60px;
}

/* ‚îÄ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ‚îÄ */
.topbar {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  gap: 6px;
  padding: 10px 12px;
  background: rgba(19,29,51,.82);
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
  border-bottom: 1px solid var(--border);
}

.topbar button {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  padding: 11px 6px;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  background: transparent;
  color: var(--text-3);
  font-family: 'Kanit', sans-serif;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all .25s cubic-bezier(.4,0,.2,1);
}

.topbar button:hover {
  color: var(--text-2);
  background: var(--surface-hi);
}

.topbar button.active {
  color: var(--text-1);
  background: var(--primary-lo);
  border-color: rgba(99,102,241,.35);
  box-shadow: 0 0 14px rgba(99,102,241,.12);
}

.topbar button .tab-icon { font-size: 15px; }

/* ‚îÄ‚îÄ‚îÄ Layout ‚îÄ‚îÄ‚îÄ */
.container {
  position: relative;
  z-index: 1;
  max-width: 480px;
  margin: 24px auto 40px;
  padding: 0 18px;
}

.page { display: none; animation: fadeUp .3s ease; }
.page.active { display: block; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ‚îÄ‚îÄ‚îÄ Section Header ‚îÄ‚îÄ‚îÄ */
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
  padding: 0 2px;
}

.section-header h4 {
  font-size: 13px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: var(--text-3);
}

.section-header .count-badge {
  font-size: 11px;
  font-weight: 500;
  color: var(--primary);
  background: var(--primary-lo);
  padding: 3px 9px;
  border-radius: 20px;
}

/* ‚îÄ‚îÄ‚îÄ Card ‚îÄ‚îÄ‚îÄ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin-bottom: 16px;
  transition: border-color .2s;
}
.card:hover { border-color: var(--border-hi); }

/* ‚îÄ‚îÄ‚îÄ Inputs ‚îÄ‚îÄ‚îÄ */
.input-row { display: flex; gap: 8px; }
.input-row input { flex: 1; }
.input-row input:last-child { flex: .45; }

input {
  display: block;
  width: 100%;
  padding: 12px 16px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--surface-hi);
  color: var(--text-1);
  font-family: 'Kanit', sans-serif;
  font-size: 14px;
  font-weight: 400;
  margin-bottom: 10px;
  transition: border-color .2s, box-shadow .2s;
  outline: none;
}

input::placeholder { color: var(--text-3); }

input:focus {
  border-color: rgba(99,102,241,.5);
  box-shadow: 0 0 0 3px rgba(99,102,241,.12);
}

input[type="date"] { color-scheme: dark; }

/* ‚îÄ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ‚îÄ */
button.main {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  width: 100%;
  padding: 13px;
  border-radius: var(--radius);
  border: none;
  background: linear-gradient(135deg, var(--primary), #818cf8);
  color: #fff;
  font-family: 'Kanit', sans-serif;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: transform .15s, box-shadow .2s, opacity .2s;
  box-shadow: 0 4px 18px rgba(99,102,241,.3);
  margin-top: 4px;
}

button.main:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 24px rgba(99,102,241,.4);
}

button.main:active { transform: translateY(0); }

button.main.secondary {
  background: var(--surface-hi);
  box-shadow: none;
  color: var(--text-2);
  font-weight: 500;
}
button.main.secondary:hover {
  background: var(--border-hi);
  box-shadow: none;
  color: var(--text-1);
}

button.main.danger {
  background: linear-gradient(135deg, var(--danger), #fb7185);
  box-shadow: 0 4px 18px rgba(248,113,113,.25);
}
button.main.danger:hover {
  box-shadow: 0 6px 24px rgba(248,113,113,.35);
}

button.main.success {
  background: linear-gradient(135deg, var(--success), #6ee7b7);
  box-shadow: 0 4px 18px rgba(52,211,153,.25);
  color: #064e3b;
}
button.main.success:hover {
  box-shadow: 0 6px 24px rgba(52,211,153,.35);
}

/* ‚îÄ‚îÄ‚îÄ Stock Item Row ‚îÄ‚îÄ‚îÄ */
.stock-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--surface-hi);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 11px 14px;
  margin-bottom: 8px;
  transition: border-color .2s;
  animation: slideIn .22s ease both;
}
.stock-item:hover { border-color: var(--border-hi); }

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-8px); }
  to   { opacity: 1; transform: translateX(0); }
}

.stock-item .item-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.stock-item .item-icon {
  width: 34px; height: 34px;
  border-radius: 9px;
  background: var(--primary-lo);
  color: var(--primary);
  display: flex; align-items: center; justify-content: center;
  font-size: 15px;
}

.stock-item .item-name {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-1);
}

.stock-item .item-qty {
  font-size: 12px;
  color: var(--text-3);
  margin-top: 1px;
}

/* ‚îÄ‚îÄ‚îÄ Qty Controls ‚îÄ‚îÄ‚îÄ */
.controls {
  display: flex;
  align-items: center;
  gap: 6px;
}

.controls button {
  width: 32px; height: 32px;
  border-radius: 8px;
  border: 1px solid var(--border);
  font-size: 17px;
  line-height: 1;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all .15s;
  background: var(--surface);
  color: var(--text-2);
}

.controls button:hover {
  border-color: var(--primary);
  color: var(--primary);
  background: var(--primary-lo);
}

.controls .qty-val {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-1);
  min-width: 22px;
  text-align: center;
  font-family: 'IBM Plex Mono', monospace;
}

/* ‚îÄ‚îÄ‚îÄ Out page add button ‚îÄ‚îÄ‚îÄ */
.add-out-btn {
  width: 34px; height: 34px;
  border-radius: 9px;
  border: none;
  background: linear-gradient(135deg, var(--primary), #818cf8);
  color: #fff;
  font-size: 18px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: transform .15s, box-shadow .2s;
  box-shadow: 0 3px 12px rgba(99,102,241,.35);
}
.add-out-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 4px 16px rgba(99,102,241,.45);
}

.remove-out-btn {
  width: 30px; height: 30px;
  border-radius: 8px;
  border: 1px solid var(--danger-lo);
  background: var(--danger-lo);
  color: var(--danger);
  font-size: 16px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background .15s;
}
.remove-out-btn:hover { background: rgba(248,113,113,.28); }

/* ‚îÄ‚îÄ‚îÄ Bill Cards ‚îÄ‚îÄ‚îÄ */
.bill-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 18px 20px;
  margin-bottom: 14px;
  transition: border-color .2s;
  animation: slideIn .22s ease both;
}
.bill-card:hover { border-color: var(--border-hi); }

.bill-card .bill-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 10px;
}

.bill-card .bill-name {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-1);
}

.bill-card .bill-meta {
  font-size: 12px;
  color: var(--text-3);
  margin-top: 3px;
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 5px 11px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: .03em;
}

.badge.pending { background: var(--warning-lo); color: var(--warning); }
.badge.paid    { background: var(--success-lo); color: var(--success); }

.bill-price {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-1);
  font-family: 'IBM Plex Mono', monospace;
  margin-bottom: 12px;
}
.bill-price span { font-size: 13px; color: var(--text-3); font-weight: 400; font-family: 'Kanit'; }

.bill-actions { display: flex; gap: 8px; }
.bill-actions button { flex: 1; }

/* ‚îÄ‚îÄ‚îÄ Bill Items List (small) ‚îÄ‚îÄ‚îÄ */
.bill-items-list {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 14px;
}

.bill-items-list .tag {
  font-size: 11px;
  font-weight: 500;
  color: var(--text-2);
  background: var(--surface-hi);
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid var(--border);
}

/* ‚îÄ‚îÄ‚îÄ Empty State ‚îÄ‚îÄ‚îÄ */
.empty-state {
  text-align: center;
  color: var(--text-3);
  padding: 32px 0;
  font-size: 14px;
}
.empty-state .empty-icon {
  font-size: 28px;
  margin-bottom: 8px;
  opacity: .5;
}

/* ‚îÄ‚îÄ‚îÄ Clear Paid Row ‚îÄ‚îÄ‚îÄ */
.clear-paid-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--danger-lo);
  border: 1px solid rgba(248,113,113,.2);
  border-radius: var(--radius);
  padding: 10px 14px;
  margin-bottom: 20px;
  animation: fadeUp .25s ease;
}

.clear-paid-row .clear-label {
  font-size: 13px;
  color: var(--danger);
  font-weight: 500;
}

.clear-paid-row .clear-label span {
  color: var(--text-3);
  font-size: 11px;
  font-weight: 400;
  display: block;
  margin-top: 2px;
}

.clear-paid-row button {
  padding: 7px 14px;
  border-radius: 9px;
  border: 1px solid rgba(248,113,113,.35);
  background: rgba(248,113,113,.12);
  color: var(--danger);
  font-family: 'Kanit', sans-serif;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: background .18s, border-color .18s;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 5px;
}

.clear-paid-row button:hover {
  background: rgba(248,113,113,.22);
  border-color: rgba(248,113,113,.5);
}

/* auto-delete notice */
.auto-del-notice {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  background: var(--surface-hi);
  border: 1px solid var(--border);
  margin-bottom: 18px;
  animation: fadeUp .25s ease;
}

.auto-del-notice .ad-icon { font-size: 14px; opacity:.6; }

.auto-del-notice .ad-text {
  font-size: 11.5px;
  color: var(--text-3);
  line-height: 1.45;
}

.auto-del-notice .ad-text strong { color: var(--text-2); font-weight: 600; }

/* ‚îÄ‚îÄ‚îÄ Bill Filter Tabs ‚îÄ‚îÄ‚îÄ */
.filter-row {
  display: flex;
  gap: 6px;
  margin-bottom: 22px;
  flex-wrap: wrap;
}

.filter-row button {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  border-radius: 24px;
  border: 1px solid var(--border);
  background: var(--surface-hi);
  color: var(--text-3);
  font-family: 'Kanit', sans-serif;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all .2s cubic-bezier(.4,0,.2,1);
}

.filter-row button:hover { color: var(--text-2); border-color: var(--border-hi); }

.filter-row button .filter-count {
  font-size: 11px;
  font-weight: 600;
  background: rgba(0,0,0,.25);
  padding: 1px 7px;
  border-radius: 10px;
  min-width: 20px;
  text-align: center;
}

/* Active states per filter */
.filter-row button.active-filter { border-color: transparent; }

.filter-row button[data-filter="all"].active-filter {
  background: var(--primary-lo);
  color: var(--primary);
  border-color: rgba(99,102,241,.3);
}
.filter-row button[data-filter="all"].active-filter .filter-count { background: rgba(99,102,241,.3); }

.filter-row button[data-filter="pending"].active-filter {
  background: var(--accent-lo);
  color: var(--accent);
  border-color: rgba(6,182,212,.3);
}
.filter-row button[data-filter="pending"].active-filter .filter-count { background: rgba(6,182,212,.3); }

.filter-row button[data-filter="deposit"].active-filter {
  background: var(--warning-lo);
  color: var(--warning);
  border-color: rgba(251,191,36,.3);
}
.filter-row button[data-filter="deposit"].active-filter .filter-count { background: rgba(251,191,36,.3); }

.filter-row button[data-filter="paid"].active-filter {
  background: var(--success-lo);
  color: var(--success);
  border-color: rgba(52,211,153,.3);
}
.filter-row button[data-filter="paid"].active-filter .filter-count { background: rgba(52,211,153,.3); }

/* ‚îÄ‚îÄ‚îÄ Payment Type Selector ‚îÄ‚îÄ‚îÄ */
.pay-type-row {
  display: flex;
  gap: 6px;
  margin-bottom: 10px;
  background: var(--surface-hi);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 5px;
}

.pay-type-row button {
  flex: 1;
  padding: 9px 6px;
  border: 1px solid transparent;
  border-radius: 11px;
  background: transparent;
  color: var(--text-3);
  font-family: 'Kanit', sans-serif;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all .2s cubic-bezier(.4,0,.2,1);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

.pay-type-row button:hover { color: var(--text-2); }

.pay-type-row button.active-pay {
  color: var(--text-1);
  background: var(--surface);
  border-color: var(--border-hi);
  box-shadow: 0 2px 8px rgba(0,0,0,.2);
}

.pay-type-row button[data-type="paid"].active-pay {
  color: var(--success);
  border-color: rgba(52,211,153,.3);
  background: var(--success-lo);
}

.pay-type-row button[data-type="deposit"].active-pay {
  color: var(--warning);
  border-color: rgba(251,191,36,.3);
  background: var(--warning-lo);
}

.pay-type-row button[data-type="pending"].active-pay {
  color: var(--accent);
  border-color: rgba(6,182,212,.3);
  background: var(--accent-lo);
}

/* Deposit detail row */
.deposit-row {
  display: flex;
  gap: 8px;
  align-items: center;
  background: var(--warning-lo);
  border: 1px solid rgba(251,191,36,.2);
  border-radius: var(--radius-sm);
  padding: 10px 14px;
  margin-bottom: 10px;
  animation: fadeUp .2s ease;
}

.deposit-row .dep-label {
  font-size: 12px;
  color: var(--warning);
  font-weight: 600;
  white-space: nowrap;
  min-width: 60px;
}

.deposit-row input {
  margin-bottom: 0;
  flex: 1;
  padding: 8px 12px;
  font-size: 14px;
  background: var(--surface);
  border-color: rgba(251,191,36,.25);
}

.deposit-row input:focus {
  border-color: rgba(251,191,36,.5);
  box-shadow: 0 0 0 3px rgba(251,191,36,.1);
}

.deposit-row .dep-remaining {
  font-size: 12px;
  color: var(--warning);
  white-space: nowrap;
  font-weight: 500;
  min-width: 75px;
  text-align: right;
}

/* Badge ‚Äî deposit */
.badge.deposit { background: var(--warning-lo); color: var(--warning); }
.badge.invoiced { background: var(--accent-lo); color: var(--accent); }

/* ‚îÄ‚îÄ‚îÄ Bill action row buttons small ‚îÄ‚îÄ‚îÄ */
.btn-row { display: flex; gap: 8px; margin-top: 10px; }
.btn-row button { flex: 1; }
</style>
</head>
<body>

<div id="main-app">

  <div class="topbar">
    <button onclick="showPage('stock')" class="active">
      <span class="tab-icon">üì¶</span> ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤
    </button>
    <button onclick="showPage('out')">
      <span class="tab-icon">üöö</span> ‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡∏Å
    </button>
    <button onclick="showPage('bill')">
      <span class="tab-icon">üßæ</span> ‡∏ö‡∏¥‡∏•
    </button>
  </div>

  <div class="container">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STOCK PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="page-stock" class="page active">

      <div class="card">
        <div class="section-header"><h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4></div>
        <div class="input-row">
          <input id="newItemName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
          <input id="newItemQty" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="1">
        </div>
        <button class="main" onclick="addStock()">
          <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        </button>
      </div>

      <div class="section-header">
        <h4>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
        <span class="count-badge" id="stockCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
      </div>
      <div id="stockList"></div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OUT PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="page-out" class="page">

      <div class="card">
        <div class="section-header"><h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏¥‡∏•</h4></div>
        <input id="billName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
        <div class="input-row">
          <input id="billDate" type="date">
          <input id="billPrice" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ö‡∏≤‡∏ó">
        </div>
      </div>

      <div class="card">
        <div class="section-header"><h4>‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢</h4></div>
        <div class="pay-type-row">
          <button data-type="pending" class="active-pay" onclick="setPayType('pending')">üìã ‡∏ß‡∏≤‡∏á‡∏ö‡∏¥‡∏•</button>
          <button data-type="deposit" onclick="setPayType('deposit')">üí∞ ‡∏°‡∏±‡∏î‡∏à‡∏≥</button>
          <button data-type="paid" onclick="setPayType('paid')">‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏•‡∏¢</button>
        </div>
        <div id="depositDetail" style="display:none;">
          <div class="deposit-row">
            <span class="dep-label">‡∏°‡∏±‡∏î‡∏à‡∏≥</span>
            <input type="number" id="depositAmt" placeholder="0" oninput="render()">
            <span class="dep-remaining" id="depRemaining">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 0</span>
          </div>
        </div>
      </div>

      <div class="section-header">
        <h4>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
      </div>
      <div id="outStock" style="margin-bottom:18px;"></div>
        <h4>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ö‡∏¥‡∏•</h4>
        <span class="count-badge" id="outCount">0</span>
      </div>
      <div id="outBill"></div>

      <button class="main" onclick="confirmBill()" style="margin-top:8px;">
        <i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏¥‡∏•
      </button>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BILL PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="page-bill" class="page" style="padding-top:10px;">

      <div class="filter-row">
        <button data-filter="all" class="active-filter" onclick="setBillFilter('all')">
          üìä ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span class="filter-count" id="fc-all">0</span>
        </button>
        <button data-filter="pending" onclick="setBillFilter('pending')">
          üìã ‡∏ß‡∏≤‡∏á‡∏ö‡∏¥‡∏• <span class="filter-count" id="fc-pending">0</span>
        </button>
        <button data-filter="deposit" onclick="setBillFilter('deposit')">
          üí∞ ‡∏°‡∏±‡∏î‡∏à‡∏≥ <span class="filter-count" id="fc-deposit">0</span>
        </button>
        <button data-filter="paid" onclick="setBillFilter('paid')">
          ‚úì ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß <span class="filter-count" id="fc-paid">0</span>
        </button>
      </div>

      <div class="auto-del-notice">
        <span class="ad-icon">üïê</span>
        <div class="ad-text">‡∏ö‡∏¥‡∏•‡∏ó‡∏µ‡πà <strong>‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</strong> ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á <strong>1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</strong></div>
      </div>

      <div id="clearPaidRow" style="display:none;">
        <div class="clear-paid-row">
          <div class="clear-label">
            ‡∏•‡∏ö‡∏ö‡∏¥‡∏•‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            <span id="clearPaidCount"></span>
          </div>
          <button onclick="clearAllPaid()"><i class="fas fa-trash"></i> ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
      </div>

      <div id="billList"></div>
    </section>

  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ
let items = JSON.parse(localStorage.getItem('items')) || [];
let bills = JSON.parse(localStorage.getItem('bills')) || [];
let outItems = [];
let currentPayType = 'pending'; // pending | deposit | paid
let billFilter = 'all';         // all | pending | deposit | paid

document.getElementById('billDate').value = new Date().toISOString().split('T')[0];

// ‚îÄ‚îÄ‚îÄ Persistence ‚îÄ‚îÄ‚îÄ
function save() {
  localStorage.setItem('items', JSON.stringify(items));
  localStorage.setItem('bills', JSON.stringify(bills));
}

// ‚îÄ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ
function showPage(p) {
  document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
  document.querySelectorAll('.topbar button').forEach(x => x.classList.remove('active'));
  const map = { stock: 0, out: 1, bill: 2 };
  document.getElementById('page-' + p).classList.add('active');
  document.querySelectorAll('.topbar button')[map[p]].classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ Pay Type ‚îÄ‚îÄ‚îÄ
function setPayType(type) {
  currentPayType = type;
  document.querySelectorAll('.pay-type-row button').forEach(b => b.classList.remove('active-pay'));
  document.querySelector(`.pay-type-row button[data-type="${type}"]`).classList.add('active-pay');
  document.getElementById('depositDetail').style.display = (type === 'deposit') ? 'block' : 'none';
  if (type !== 'deposit') document.getElementById('depositAmt').value = '';
  render();
}

// ‚îÄ‚îÄ‚îÄ Bill Filter ‚îÄ‚îÄ‚îÄ
function setBillFilter(f) {
  billFilter = f;
  document.querySelectorAll('.filter-row button').forEach(b => b.classList.remove('active-filter'));
  document.querySelector(`.filter-row button[data-filter="${f}"]`).classList.add('active-filter');
  render();
}

// ‚îÄ‚îÄ‚îÄ Stock ‚îÄ‚îÄ‚îÄ
function addStock() {
  const n = document.getElementById('newItemName').value.trim();
  const q = Number(document.getElementById('newItemQty').value);
  if (!n || q <= 0) return;
  const existing = items.find(i => i.name === n);
  if (existing) { existing.qty += q; }
  else { items.push({ name: n, qty: q }); }
  document.getElementById('newItemName').value = '';
  document.getElementById('newItemQty').value = '';
  save(); render();
}

// ‚îÄ‚îÄ‚îÄ Out ‚îÄ‚îÄ‚îÄ
function addOut(i) {
  if (items[i].qty <= 0) return;
  items[i].qty--;
  const b = outItems.find(x => x.name === items[i].name);
  b ? b.qty++ : outItems.push({ name: items[i].name, qty: 1 });
  save(); render();
}

function removeOut(i) {
  const b = outItems[i];
  const it = items.find(x => x.name === b.name);
  if (it) it.qty++;
  b.qty--;
  if (b.qty <= 0) outItems.splice(i, 1);
  save(); render();
}

function confirmBill() {
  if (!outItems.length) { alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ö‡∏¥‡∏•'); return; }
  const price = Number(document.getElementById('billPrice').value) || 0;
  const deposit = (currentPayType === 'deposit') ? (Number(document.getElementById('depositAmt').value) || 0) : 0;

  bills.push({
    billName: document.getElementById('billName').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
    date: document.getElementById('billDate').value,
    price: price,
    payType: currentPayType,          // pending | deposit | paid
    deposit: deposit,                 // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ (‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á payType=deposit)
    remaining: (currentPayType === 'deposit') ? Math.max(price - deposit, 0) : (currentPayType === 'paid' ? 0 : price),
    status: currentPayType === 'paid' ? 'paid' : 'pending', // paid ‚Üí ‡∏à‡∏ö‡πÄ‡∏•‡∏¢, ‡∏≠‡∏∑‡πà‡∏ô ‚Üí pending
    items: JSON.parse(JSON.stringify(outItems))
  });

  outItems = [];
  document.getElementById('billName').value = '';
  document.getElementById('billPrice').value = '';
  document.getElementById('depositAmt').value = '';
  setPayType('pending');
  save(); render(); showPage('bill');
}

// ‚îÄ‚îÄ‚îÄ Bill Actions ‚îÄ‚îÄ‚îÄ
function markPaid(i) {
  // ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ stock
  bills[i].items.forEach(b => {
    const it = items.find(x => x.name === b.name);
    if (it) it.qty += b.qty;
  });
  bills[i].status = 'paid';
  bills[i].remaining = 0;
  bills[i].paidAt = Date.now();
  save(); render();
}

function clearBill(i) {
  bills[i].items.forEach(b => {
    const it = items.find(x => x.name === b.name);
    if (it) it.qty += b.qty;
  });
  bills.splice(i, 1);
  save(); render();
}

// ‚îÄ‚îÄ‚îÄ Auto-delete ‡∏ö‡∏¥‡∏•‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô 30 ‡∏ß‡∏±‡∏ô ‚îÄ‚îÄ‚îÄ
function autoCleanup() {
  const ONE_MONTH = 30 * 24 * 60 * 60 * 1000;
  const now = Date.now();
  const before = bills.length;
  bills = bills.filter(b => {
    if (b.status === 'paid' && b.paidAt && (now - b.paidAt) > ONE_MONTH) return false;
    return true;
  });
  if (bills.length !== before) { save(); }
}

// ‚îÄ‚îÄ‚îÄ ‡∏•‡∏ö‡∏ö‡∏¥‡∏•‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≤‡∏¢‡∏ö‡∏¥‡∏• ‚îÄ‚îÄ‚îÄ
function deletePaidBill(i) {
  bills.splice(i, 1); // ‡∏Ç‡∏≠‡∏á‡πÄtrick‡πà ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≠‡∏ô markPaid ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô‡∏ã‡πâ‡∏≥
  save(); render();
}

// ‚îÄ‚îÄ‚îÄ ‡∏•‡∏ö‡∏ö‡∏¥‡∏•‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (manual) ‚îÄ‚îÄ‚îÄ
function clearAllPaid() {
  const cnt = bills.filter(b => b.status === 'paid').length;
  if (!cnt) return;
  if (!confirm(`‡∏•‡∏ö‡∏ö‡∏¥‡∏•‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${cnt} ‡∏ö‡∏¥‡∏•?`)) return;
  bills = bills.filter(b => b.status !== 'paid');
  save(); render();
}

// ‚îÄ‚îÄ‚îÄ helpers ‚îÄ‚îÄ‚îÄ
function getBadgeHTML(bill) {
  if (bill.status === 'paid') return `<span class="badge paid">‚úì ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>`;
  if (bill.payType === 'deposit') return `<span class="badge deposit">üí∞ ‡∏°‡∏±‡∏î‡∏à‡∏≥</span>`;
  return `<span class="badge invoiced">üìã ‡∏ß‡∏≤‡∏á‡∏ö‡∏¥‡∏•</span>`;
}

// ‚îÄ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ
function render() {
  // ‚îÄ‚îÄ Stock list ‚îÄ‚îÄ
  document.getElementById('stockCount').textContent = items.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
  document.getElementById('stockList').innerHTML = items.length
    ? items.map((it, i) => `
        <div class="stock-item" style="animation-delay:${i*.04}s">
          <div class="item-left">
            <div class="item-icon">üì¶</div>
            <div>
              <div class="item-name">${it.name}</div>
              <div class="item-qty">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${it.qty} ‡∏ä‡∏¥‡πâ‡∏ô</div>
            </div>
          </div>
          <div class="controls">
            <button onclick="items[${i}].qty--; save(); render();" title="‡∏•‡∏î">‚àí</button>
            <span class="qty-val">${it.qty}</span>
            <button onclick="items[${i}].qty++; save(); render();" title="‡πÄ‡∏û‡∏¥‡πà‡∏°">+</button>
          </div>
        </div>`).join('')
    : `<div class="empty-state"><div class="empty-icon">üì¶</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>`;

  // ‚îÄ‚îÄ Out ‚Äî stock selector ‚îÄ‚îÄ
  document.getElementById('outStock').innerHTML = items.map((it, i) => `
    <div class="stock-item" style="animation-delay:${i*.04}s">
      <div class="item-left">
        <div class="item-icon" style="background:var(--accent-lo);color:var(--accent);">üìå</div>
        <div>
          <div class="item-name">${it.name}</div>
          <div class="item-qty">${it.qty} ‡∏ä‡∏¥‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
        </div>
      </div>
      <button class="add-out-btn" onclick="addOut(${i})">+</button>
    </div>`).join('') || `<div class="empty-state"><div class="empty-icon">üì¶</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>`;

  // ‚îÄ‚îÄ Out ‚Äî bill items ‚îÄ‚îÄ
  const outTotal = outItems.reduce((s, o) => s + o.qty, 0);
  document.getElementById('outCount').textContent = outTotal;
  document.getElementById('outBill').innerHTML = outItems.length
    ? outItems.map((b, i) => `
        <div class="stock-item" style="animation-delay:${i*.04}s">
          <div class="item-left">
            <div class="item-icon" style="background:var(--success-lo);color:var(--success);">‚úì</div>
            <div>
              <div class="item-name">${b.name}</div>
              <div class="item-qty">√ó ${b.qty} ‡∏ä‡∏¥‡πâ‡∏ô</div>
            </div>
          </div>
          <button class="remove-out-btn" onclick="removeOut(${i})">‚àí</button>
        </div>`).join('')
    : `<div class="empty-state"><div class="empty-icon">üßæ</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ö‡∏¥‡∏•</div>`;

  // ‚îÄ‚îÄ Deposit remaining preview ‚îÄ‚îÄ
  const totalPrice = Number(document.getElementById('billPrice').value) || 0;
  const depAmt = Number(document.getElementById('depositAmt').value) || 0;
  const rem = Math.max(totalPrice - depAmt, 0);
  document.getElementById('depRemaining').textContent = '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + rem.toLocaleString();

  // ‚îÄ‚îÄ Bills ‚Äî filter counts ‚îÄ‚îÄ
  const cAll = bills.length;
  const cPending = bills.filter(b => b.status === 'pending' && b.payType === 'pending').length;
  const cDeposit = bills.filter(b => b.payType === 'deposit' && b.status === 'pending').length;
  const cPaid   = bills.filter(b => b.status === 'paid').length;

  document.getElementById('fc-all').textContent     = cAll;
  document.getElementById('fc-pending').textContent = cPending;
  document.getElementById('fc-deposit').textContent = cDeposit;
  document.getElementById('fc-paid').textContent    = cPaid;

  // ‚îÄ‚îÄ show/hide ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î row ‚îÄ‚îÄ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ filter = paid)
  const paidCount = bills.filter(b => b.status === 'paid').length;
  const showClear = (billFilter === 'paid' && paidCount > 0);
  document.getElementById('clearPaidRow').style.display = showClear ? 'block' : 'none';
  document.getElementById('clearPaidCount').textContent = paidCount + ' ‡∏ö‡∏¥‡∏•';

  // ‚îÄ‚îÄ filter logic ‚îÄ‚îÄ
  let filtered = bills.map((b, i) => ({ ...b, idx: i }));

  if (billFilter === 'pending')  filtered = filtered.filter(b => b.status === 'pending' && b.payType === 'pending');
  if (billFilter === 'deposit')  filtered = filtered.filter(b => b.payType === 'deposit' && b.status === 'pending');
  if (billFilter === 'paid')     filtered = filtered.filter(b => b.status === 'paid');

  // ‚îÄ‚îÄ render list ‚îÄ‚îÄ
  document.getElementById('billList').innerHTML = filtered.length
    ? filtered.map((b, ri) => `
        <div class="bill-card" style="animation-delay:${ri*.05}s; ${b.status === 'paid' ? 'opacity:.65;' : ''}">
          <div class="bill-header">
            <div>
              <div class="bill-name">${b.billName}</div>
              <div class="bill-meta">${b.date}</div>
            </div>
            ${getBadgeHTML(b)}
          </div>
          <div class="bill-items-list">
            ${b.items.map(it => `<span class="tag">${it.name} √ó${it.qty}</span>`).join('')}
          </div>
          <div class="bill-price">
            ${b.price.toLocaleString()} <span>‡∏ö‡∏≤‡∏ó</span>
            ${b.payType === 'deposit'
              ? `<span style="margin-left:10px;font-size:12px;color:${b.status==='paid'?'var(--text-3)':'var(--warning)'};font-family:'Kanit';font-weight:500;">
                  ‡∏°‡∏±‡∏î‡∏à‡∏≥ ${b.deposit.toLocaleString()} ‚Ä¢ ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <strong>${b.remaining.toLocaleString()}</strong>
                </span>` : ''}
          </div>
          ${b.status === 'pending' ? `
            <div class="bill-actions">
              <button class="main success" onclick="markPaid(${b.idx})"><i class="fas fa-check"></i> ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</button>
              <button class="main danger"  onclick="clearBill(${b.idx})"><i class="fas fa-trash"></i> ‡∏•‡∏ö</button>
            </div>` : `
            <div class="bill-actions">
              <button class="main danger" onclick="deletePaidBill(${b.idx})"><i class="fas fa-trash"></i> ‡∏•‡∏ö‡∏ö‡∏¥‡∏•</button>
            </div>`}
        </div>`).join('')
    : `<div class="empty-state"><div class="empty-icon">üìã</div>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏¥‡∏•‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ</div>`;
}

autoCleanup();
render();
</script>

</body>
</html>
